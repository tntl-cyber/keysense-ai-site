<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KeySense AI Analysis Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #F3F4F6;
            --bg-card: #FFFFFF;
            --primary: #4F46E5;
            --text-main: #111827;
            --text-sub: #6B7280;
            --accent-green: #10B981;
            --accent-orange: #F59E0B;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg-body); color: var(--text-main); margin: 0; padding: 0; }
        
        /* LAYOUT */
        .main-wrapper { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
        
        /* HEADER / HERO */
        .hero { text-align: center; margin-bottom: 40px; }
        .hero h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; color: var(--text-main); }
        .hero p { color: var(--text-sub); font-size: 1.1rem; }

        /* INPUT CARD */
        .search-card { background: var(--bg-card); padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); text-align: center; margin-bottom: 40px; }
        .input-box { display: flex; gap: 10px; max-width: 600px; margin: 0 auto; }
        .input-box input { flex: 1; padding: 14px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 1rem; outline: none; transition: border 0.2s; }
        .input-box input:focus { border-color: var(--primary); }
        .btn-analyze { background: var(--text-main); color: white; border: none; padding: 14px 28px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-analyze:hover { background: #000; }

        /* LOADING */
        .loader { display: none; margin: 40px auto; text-align: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #E5E7EB; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* REPORT DASHBOARD (HIDDEN INITIALLY) */
        .report-grid { display: none; grid-template-columns: 2fr 1fr; gap: 24px; opacity: 0; transition: opacity 0.5s; }
        .col-left { display: flex; flex-direction: column; gap: 24px; }
        .col-right { display: flex; flex-direction: column; gap: 24px; }

        /* CARDS */
        .card { background: var(--bg-card); border-radius: 12px; padding: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid #F3F4F6; }
        .card-header { font-size: 1.1rem; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; color: var(--text-main); border-bottom: 1px solid #F3F4F6; padding-bottom: 12px; }
        .icon { width: 20px; height: 20px; }

        /* CONTENT STYLES */
        .summary-text { line-height: 1.6; color: #374151; font-size: 0.95rem; }
        
        .keyword-pill { display: inline-block; background: #EEF2FF; color: var(--primary); padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; font-weight: 500; margin: 4px 4px 4px 0; }
        .gap-pill { display: inline-block; background: #FEF3C7; color: #D97706; padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; font-weight: 600; margin: 4px 4px 4px 0; }

        .list-item { padding: 12px 0; border-bottom: 1px solid #F3F4F6; }
        .list-item:last-child { border-bottom: none; }
        .item-title { font-weight: 600; font-size: 0.95rem; display: block; margin-bottom: 4px; }
        .item-desc { font-size: 0.85rem; color: var(--text-sub); line-height: 1.4; }

        /* CTA BOX */
        .cta-box { background: linear-gradient(135deg, #111827 0%, #374151 100%); color: white; text-align: center; }
        .stat-big { font-size: 2.5rem; font-weight: 800; margin: 10px 0; color: #10B981; }
        .btn-upgrade { background: #FF642D; color: white; text-decoration: none; padding: 12px 24px; border-radius: 6px; font-weight: 700; display: inline-block; margin-top: 15px; width: 100%; box-sizing: border-box; }
        .btn-upgrade:hover { background: #ff4500; }

        @media (max-width: 768px) { .report-grid { grid-template-columns: 1fr; } .input-box { flex-direction: column; } }
    </style>
</head>
<body>

<div class="main-wrapper">
    
    <div class="hero">
        <h1>KeySense AI Report</h1>
        <p>Enter a competitor URL to uncover their strategy.</p>
    </div>

    <div class="search-card" id="searchArea">
        <div class="input-box">
            <input type="text" id="urlInput" placeholder="https://competitor.com">
            <button class="btn-analyze" onclick="startAnalysis()">
                <span>Run Analysis</span>
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            </button>
        </div>
    </div>

    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p style="color: #6B7280; font-size: 0.9rem;">Analiziram vsebino... (To lahko traja 10s)</p>
    </div>

    <!-- THE REPORT (OPAL STYLE) -->
    <div class="report-grid" id="report">
        
        <!-- LEFT COLUMN (Main Insights) -->
        <div class="col-left">
            <!-- Summary -->
            <div class="card">
                <div class="card-header">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    Competitor Summary
                </div>
                <div class="summary-text" id="summaryText">Loading...</div>
            </div>

            <!-- Money Keywords -->
            <div class="card">
                <div class="card-header">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Money Keywords (Found)
                </div>
                <div id="moneyKeywords"></div>
            </div>

            <!-- Optimization Recommendations -->
            <div class="card">
                <div class="card-header">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    Optimization Plan
                </div>
                <div id="recommendationsList"></div>
            </div>
            
            <!-- Article Ideas -->
            <div class="card">
                <div class="card-header">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                    Content Strategy (Articles)
                </div>
                <div id="articlesList"></div>
            </div>
        </div>

        <!-- RIGHT COLUMN (Stats & Gaps) -->
        <div class="col-right">
            <!-- CTA CARD -->
            <div class="card cta-box">
                <div style="font-size: 0.9rem; opacity: 0.8;">Hidden Keywords</div>
                <div class="stat-big" id="hiddenCount">...</div>
                <p id="upgradeHook" style="font-size: 0.85rem; margin-bottom: 15px;">...</p>
                <a href="https://www.semrush.com/" class="btn-upgrade" target="_blank">Unlock Full Report</a>
            </div>

            <!-- GAP KEYWORDS -->
            <div class="card">
                <div class="card-header">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    Content Gaps (Missing)
                </div>
                <div id="gapKeywords"></div>
                <p style="font-size: 0.8rem; color: #6B7280; margin-top: 10px;">*Keywords competitors use but you don't.</p>
            </div>
        </div>

    </div>

</div>

<script>
    async function startAnalysis() {
        const url = document.getElementById('urlInput').value;
        if (!url || url.length < 5) return alert("Please enter a URL");

        // UI Updates
        document.getElementById('searchArea').style.display = 'none';
        document.getElementById('loader').style.display = 'block';

        try {
            const res = await fetch(`/api/analyze?url=${encodeURIComponent(url)}`);
            const data = await res.json();

            // 1. Summary
            document.getElementById('summaryText').innerText = data.competitor_summary || "Analysis complete.";

            // 2. Money Keywords
            const moneyContainer = document.getElementById('moneyKeywords');
            moneyContainer.innerHTML = '';
            if (data.money_list_keywords) {
                data.money_list_keywords.forEach(kw => {
                    moneyContainer.innerHTML += `<span class="keyword-pill">${kw}</span>`;
                });
            }

            // 3. Gap Keywords
            const gapContainer = document.getElementById('gapKeywords');
            gapContainer.innerHTML = '';
            if (data.content_gap_keywords) {
                data.content_gap_keywords.forEach(kw => {
                    gapContainer.innerHTML += `<span class="gap-pill">${kw}</span>`;
                });
            }

            // 4. Hidden Count
            document.getElementById('hiddenCount').innerText = data.hidden_keywords_count || "500+";
            document.getElementById('upgradeHook').innerText = data.upgrade_hook || "Unlock data now.";

            // 5. Recommendations
            const recContainer = document.getElementById('recommendationsList');
            recContainer.innerHTML = '';
            if (data.recommendations) {
                data.recommendations.forEach(rec => {
                    recContainer.innerHTML += `
                        <div class="list-item">
                            <span class="item-title">‚úÖ ${rec.title}</span>
                            <span class="item-desc">${rec.desc}</span>
                        </div>
                    `;
                });
            }

            // 6. Articles
            const artContainer = document.getElementById('articlesList');
            artContainer.innerHTML = '';
            if (data.article_ideas) {
                data.article_ideas.forEach(art => {
                    artContainer.innerHTML += `
                        <div class="list-item">
                            <span class="item-title">üìù ${art.title}</span>
                            <span class="item-desc">${art.outline}</span>
                        </div>
                    `;
                });
            }

            // Show Report
            document.getElementById('loader').style.display = 'none';
            const report = document.getElementById('report');
            report.style.display = 'grid';
            setTimeout(() => report.style.opacity = '1', 100);

        } catch (e) {
            alert("Analysis took too long or failed. Please try again.");
            location.reload();
        }
    }
</script>

</body>
</html>